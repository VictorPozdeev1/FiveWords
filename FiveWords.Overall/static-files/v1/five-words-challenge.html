<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Five Words</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="css/main-style.css">
  </head>
  <body>
    <div id="main-div" class="px-4 py-5 my-5 text-center">
      <p id="progress-label"></p>
        <h2 id="russian-word">RussianWord</h2>
      <br>
    </div>

    <script>
    Main();
    async function Main()
    {
      const challenge = await GetChallenge();
      let userAnswers = [];
      for (var i = 0; i < challenge.units.length; i++)
      {
        const challengeUnit = challenge.units[i];
        const text = `Cлово ${i+1} из ${challenge.units.length}:`;
        document.querySelector('#progress-label').innerHTML = text;
        document.querySelector('#russian-word').innerHTML = challengeUnit.question.writing;
        let promise = new Promise(function(resolve, reject)
        {
          for (var j = 0; j < challengeUnit.answerVariants.length; j++)
            CreateVariantButton(j, challengeUnit.answerVariants[j].writing, resolve)
        });
        userAnswers[i] = await promise;
        document.querySelectorAll('#main-div>button').forEach(el=>el.remove());
      }
      await GetChallengeResult(userAnswers);
    }
    function CreateVariantButton(btnIndex, btnText, resolve)
    {
      var button = document.createElement("button");
      button.setAttribute("class", "btn btn-light gap-3");
      button.append(btnText);
      button.addEventListener("click", ()=>resolve(btnIndex));
      document.querySelector('#main-div').append(button);
    }
    async function GetChallenge()
    {
      //const urlString = "/challenge/guess-translate?" + new URLSearchParams({unitsCount: 5, answerVariantsCount : 5 });
      const urlString = "challenge/guess-translate/5:5"; // without a preceding slash, equals to "/v1/challenge..."
      const response = await fetch(urlString, {
                method: "GET",
                headers: { "Accept": "application/json" }
            })
      if (response.ok)
      {
        const challenge = await response.json();
        return challenge;
      }
    }
    async function GetChallengeResult(userAnswers)
    {
        const response = await fetch("challenge-result/guess-right-variant", {  // without a preceding slash, equals to "/v1/challenge-result..."
                method: "POST",
                headers: { "Accept": "text/html", "Content-Type": "application/json" },
                body: JSON.stringify(userAnswers)
            })
      if (response.ok) document.write(await response.text());
    }
    </script>
  </body>
</html>
